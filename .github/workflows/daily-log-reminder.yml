name: Daily Learning Log Reminder

# æ¯æ—¥21:00 JST (12:00 UTC) ã«ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼ã‚’å®Ÿè¡Œ
on:
  schedule:
    - cron: '0 12 * * *'
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  check-daily-log:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check if today's log exists
        id: check
        run: |
          TODAY=$(TZ=Asia/Tokyo date +%Y-%m-%d)
          if grep -q "^## ${TODAY}" daily_log.md; then
            echo "logged=true" >> "$GITHUB_OUTPUT"
            echo "ä»Šæ—¥ï¼ˆ${TODAY}ï¼‰ã®å­¦ç¿’ãƒ­ã‚°ã¯è¨˜éŒ²æ¸ˆã¿ã§ã™"
          else
            echo "logged=false" >> "$GITHUB_OUTPUT"
            echo "ä»Šæ—¥ï¼ˆ${TODAY}ï¼‰ã®å­¦ç¿’ãƒ­ã‚°ãŒã¾ã è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“"
          fi

      - name: Create reminder issue
        if: steps.check.outputs.logged == 'false'
        uses: actions/github-script@v7
        with:
          script: |
            const today = new Date().toLocaleDateString('ja-JP', {
              timeZone: 'Asia/Tokyo',
              year: 'numeric',
              month: '2-digit',
              day: '2-digit'
            });

            // æ—¢å­˜ã®ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼issueãŒé–‹ã„ã¦ã„ã‚Œã°ä½œæˆã—ãªã„
            const issues = await github.rest.issues.listForRepo({
              owner: context.repo.owner,
              repo: context.repo.repo,
              state: 'open',
              labels: 'daily-log-reminder'
            });

            if (issues.data.length === 0) {
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `ğŸ“ å­¦ç¿’ãƒ­ã‚°æœªè¨˜å…¥: ${today}`,
                body: `ä»Šæ—¥ã®å­¦ç¿’ãƒ­ã‚°ãŒã¾ã è¨˜éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\n\n` +
                      `ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§è¨˜éŒ²ã§ãã¾ã™:\n` +
                      '```bash\n' +
                      `./log.sh "ä»Šæ—¥ã®å­¦ç¿’å†…å®¹"\n` +
                      '```\n',
                labels: ['daily-log-reminder']
              });
            }
